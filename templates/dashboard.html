<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Crypto Portfolio Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        /* Keep your existing styles */
        body { font-family: 'Segoe UI', Arial, sans-serif; max-width: 1400px; margin: 0 auto; padding: 20px; background: #f8f9fa; color: #333; }
        .header { background: #fff; padding: 24px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); margin-bottom: 32px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px; }
        .header h1 { margin: 0; font-size: 2em; font-weight: 600; }
        .wallet { font-family: monospace; font-size: 1.1em; background: #f0f0f0; padding: 10px 16px; border-radius: 8px; }
        .actions button, .actions a { padding: 12px 24px; border-radius: 8px; font-size: 1em; text-decoration: none; cursor: pointer; }
        .actions button { background: #0066ff; color: white; border: none; }
        .actions a { background: #f0f0f0; color: #111; }

        .summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .card { background: #fff; padding: 24px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); }
        .card h3 { margin: 0 0 12px; color: #666; font-weight: 500; }
        .card .value { font-size: 2.4em; font-weight: 700; }

        table { width: 100%; background: #fff; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.06); border-collapse: collapse; }
        th { background: #f8f9fa; padding: 20px; text-align: left; font-weight: 600; color: #444; }
        td { padding: 18px 20px; border-bottom: 1px solid #eee; }
        tr:hover { background: #f8fbff; }
        .asset { font-weight: 600; font-size: 1.1em; }
        .warning { color: #d32f2f; font-size: 0.9em; }
        .chain { color: #666; text-transform: capitalize; }
        .quantity, .usd { text-align: right; font-family: monospace; }
        .usd { font-weight: 600; }
        .zero-usd { color: #999; font-style: italic; }

        .note { background: #e6f0ff; padding: 20px; border-radius: 12px; margin: 40px 0; border-left: 5px solid #0066ff; color: #004499; }
        .load-wallet { background: #fff; padding: 30px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); margin-top: 40px; }
        .load-wallet input { width: 100%; max-width: 600px; padding: 14px; border: 1px solid #ddd; border-radius: 8px; font-size: 1.1em; }
    </style>
</head>
<body>

<div class="header">
    <div>
        <h1>Crypto Portfolio Tracker</h1>
        <div class="wallet">{{ wallet }}</div>
    </div>
    <div class="actions">
        <form method="post" action="/" style="display:inline;">
            <input type="hidden" name="wallet" value="{{ wallet }}">
            <button type="submit">Save Snapshot</button>
        </form>
        <a href="/export-csv?wallet={{ wallet }}">Export to CSV</a>
        <a href="/change-wallet">Change Wallet</a>
    </div>
</div>

{% if portfolio %}
    <div class="summary">
        <div class="card">
            <h3>Total Value</h3>
            <div class="value">${{ "%.2f"|format(total_value) }}</div>
        </div>
        <div class="card">
            <h3>Holdings</h3>
            <div class="value">{{ portfolio|length }}</div>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>Asset</th>
                <th>Chain</th>
                <th class="quantity">Quantity</th>
                <th class="usd">Value (USD)</th>
            </tr>
        </thead>
        <tbody>
            {% for item in portfolio %}
            <tr>
                <td class="asset">
                    {{ item.symbol }}
                    {% if item.note %}
                        <span class="warning">({{ item.note }})</span>
                    {% endif %}
                </td>
                <td class="chain">{{ item.chain }}</td>
                <td class="quantity">{{ "%.8g"|format(item.amount) }}</td>
                <td class="usd">
                    {% if item.current_value > 0 %}
                        ${{ "%.2f"|format(item.current_value) }}
                    {% else %}
                        <span class="zero-usd">$0.00</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="note">
        <p><strong>Clean & Accurate:</strong> Scam tokens filtered. Dust (<$1) hidden. Absurd values capped.</p>
        <p>Matches DeBank/Zerion: Real ETH per chain, stablecoins $1.00, no junk.</p>
    </div>

{% else %}
    <div class="card" style="text-align:center; padding:60px;">
        <h2>No Significant Holdings</h2>
        <p>Only major assets shown. Dust/scams filtered.</p>
    </div>
{% endif %}

<div class="load-wallet">
    <h2>Load Another Wallet</h2>
    <form method="get" action="/">
        <input type="text" name="wallet" placeholder="0x..." value="{{ wallet }}" required>
        <button type="submit">View Portfolio</button>
    </form>
</div>

</body>
</html>